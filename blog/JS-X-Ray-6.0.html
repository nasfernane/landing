<!DOCTYPE html>
<html lang="en">
  
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link
    href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&display=swap"
    rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="../css/reset.css" />
  <link rel="stylesheet" href="../css/index.css" />
  <link rel="stylesheet" href="../css/blog.css" />
  <title>NodeSecure - Blog</title>
</head>

<body>
  <canvas id="network-bg"></canvas>

  <header class="blogHeader">
    <div class="header-background"></div>
    <div class="header-content centered-content">
      <img src="https://avatars.githubusercontent.com/u/85318671?s=200&v=4" alt="NodeSecure Logo"
        style="width:80px;height:80px;border-radius:20px;background:#fff2;box-shadow:0 2px 8px #0002;margin-bottom:1.2rem;">
      <h1>
        NodeSecure Blog
      </h1>
      <p class="subtitle">
        Building a safer Node.js and JavaScript ecosystem
      </p>
      <p class="description">We are a community of developers building free open source tools to secure the Node.js & JavaScript ecosystem. Our area of expertise is <b>SCA</b> (Software Composition Analysis).</p>
      <div class="header-buttons">
        <a href="https://github.com/NodeSecure" target="_blank" title="NodeSecure on GitHub" class="view-on-github">
          <img src="https://cdn.jsdelivr.net/gh/simple-icons/simple-icons/icons/github.svg" alt="GitHub"
            style="width:28px;height:28px;filter:invert(1) brightness(2);">
          <span>View on GitHub</span>
        </a>
        <a href="https://discord.gg/4Wn8rjAtB4" target="_blank" title="Join our Discord" class="view-on-discord">
          <img src="https://cdn.jsdelivr.net/gh/simple-icons/simple-icons/icons/discord.svg" alt="Discord"
            style="width:28px;height:28px;filter:invert(1) brightness(2);">
          <span>Join Discord</span>
        </a>
        <a href="./index.html" title="Visit our blog" class="view-on-discord">
          <img width="64" height="64" src="https://img.icons8.com/glyph-neue/64/circled-left-2.png"   style="width:28px;height:28px;filter:invert(1) brightness(2);" alt="Back to blog"/>
          <span>Back to blog</span>
        </a>
      </div>
    </div>
  </header>
  <main>
    
    <article>
      <div class="article-content">
        <h1 class="article-title">JS-X-Ray 6.0</h1>
        <p>Hello üëã</p>
<p>It's been a while since the <strong>last article</strong> on JS-X-Ray üò≤!</p>
<p><a href="https://dev.to/nodesecure/js-x-ray-3-0-0-3ddn" target="_blank" rel="noopener" class="external-article-link">‚Ü™ Read article</a></p>
<p>In this article I will present you the latest major version üëÄ. I didn't do an article on version 4 and 5 because they didn't introduce new features (only breaking changes on the API).</p>
<h2>üì¢ What is JS-X-Ray ?</h2>
<p>If you are new in town, <a href="https://github.com/NodeSecure/js-x-ray">JS-X-Ray</a> is an open source JavaScript SAST (Static Application Security Testing). The tool analyzes your JavaScript sources for patterns that may affect the security and quality of your project üòé.</p>
<p>Among the notable features:</p>
<ul>
<li>Retrieving dependencies (CJS &amp; ESM support) and detecting suspicious import/require.</li>
<li>Detecting unsafe RegEx.</li>
<li>Detecting obfuscated source (and provide hints on the tool used).</li>
</ul>
<p>As well as a lot of <a href="https://github.com/NodeSecure/js-x-ray#warnings-legends">other detections</a>.</p>
<h2>Major release 4 and 5</h2>
<p>These versions introduced changes on warnings (and we improved how we manage them in the codebase). We added new descriptors for each of them:</p>
<ul>
<li>i18n (for translation in <a href="https://github.com/NodeSecure/ci">CI</a> or <a href="https://github.com/NodeSecure/cli">CLI</a>).</li>
<li>experimental</li>
<li>severity (Information, Warning, Critical)</li>
</ul>
<p>Those information are visible in the <a href="https://github.com/NodeSecure/cli">NodeSecure CLI</a> interface:</p>
<p><img src="https://dev-to-uploads.s3.amazonaws.com/uploads/articles/0xjxew9sh7xm07wxhkef.png" alt="NodeSecure"></p>
<h2>Major release 6</h2>
<p>üê¨ Ok, let's dive into this major release to discover the surprises üéâ it has in store for us.</p>
<h3>üöÄ Introducing VariableTracer</h3>
<p>Almost a year of work on this <a href="https://github.com/NodeSecure/estree-ast-utils/blob/main/src/utils/VariableTracer.js">new mechanism / class</a> that brings a whole new dimension to JS-X-Ray.</p>
<pre><code class="language-js">const tracer = new VariableTracer()
  .enableDefaultTracing()
  .trace("crypto.createHash", {
    followConsecutiveAssignment: true, moduleName: "crypto"
  });

tracer.walk(node);
</code></pre>
<p>This class is able to follow all declarations, assignments and patterns (and those even through very obscure patterns). </p>
<pre><code class="language-js">const aA = Function.prototype.call;
const bB = require;

const crypto = aA.call(bB, bB, "crypto");
const cr = crypto.createHash;
cr("md5"); // weak-crypto warning is throw here
</code></pre>
<p>This allows us to implement Probes in a much simpler way (which makes maintenance and testing much easier).</p>
<p>Here an example with the <code>isWeakCrypto</code> probe:</p>
<pre><code class="language-js">function validateNode(node, { tracer }) {
  const id = getCallExpressionIdentifier(node);
  if (id === null || !tracer.importedModules.has("crypto")) {
    return [false];
  }

  const data = tracer.getDataFromIdentifier(id);

  return [
    data !== null &amp;&amp;
    data.identifierOrMemberExpr === "crypto.createHash"
  ];
}
</code></pre>
<p>By default the Tracer follows all ways of <code>requiring</code> dependencies with CJS and also usage of <code>eval</code> or <code>Function</code>.</p>
<h3>üöß Removing unsafe-assign warning</h3>
<p>This warning was required at the beginning of the project because it was difficult for me to correctly identify some malicious patterns.</p>
<p><img src="https://dev-to-uploads.s3.amazonaws.com/uploads/articles/wscxxpedjz513w9rtxds.png" alt="NodeSecure"></p>
<p>However, with the introduction of the new Tracer, which is very complete and precise, this warning no longer makes sense has it only generates unnecessary noise and false positives.</p>
<h3>üìú Better ESM source parsing</h3>
<p>We previously had a lot of <code>parsing-error</code> warnings because the NodeSecure scanner failed to detect if the file was using either CJS or ESM. </p>
<p>That new version will automatically retry with ESM enabled if it fails with CJS.</p>
<h3>üìâ Reducing false positives</h3>
<p>To continue the momentum of the previous sections. This version drops a lot of warnings and significantly improves others.</p>
<ul>
<li>Reducing false positives for <code>encoded-literal</code> warning by introducing new way of detecting safe values.</li>
<li>Improve <code>short-identifiers</code> by also storing ClassDeclaration, MethodDefinition and Function parameters.</li>
</ul>
<p>We are also introducing a new <code>suspicious-file</code> warning when a file contain more than 10 encoded-literal warnings to avoid having file with hundreds or thousands of warnings.</p>
<p>Of the <strong>500</strong> most popular NPM packages, we previously had <strong>24k</strong> warnings with version 5. The latest version brings that number down to approximatively <strong>5k</strong> warnings.</p>
<h3>üî¨ Improving coverage</h3>
<p>A lot of work has been done to add unit tests on all the probes of the project. We are near 100% of coverage üí™.</p>
<p><img src="https://dev-to-uploads.s3.amazonaws.com/uploads/articles/07uejv3fgthptaymwj5j.png" alt="NodeSecure"></p>
<p>Thanks to the amazing work of our contributors:</p>
<ul>
<li><a href="https://github.com/Kawacrepe">Vincent DHENNIN</a> - @kawacrepe</li>
<li><a href="https://github.com/PierreDemailly">Pierre DEMAILLY</a></li>
<li><a href="https://www.linkedin.com/in/mathieu-kahlaoui-0887a1158/">Mathieu KA</a></li>
<li><a href="https://github.com/M4gie">M4gie</a></li>
</ul>
<h2>üëÄ What's next ?</h2>
<p>Here what I'm working for the next major release:</p>
<ul>
<li>Adding support of TypeScript sources (probably by allowing a customization of the parser).</li>
<li>A new API that allows to dynamically extend the SAST with new custom probes (and custom warnings).</li>
<li>Introducing new built-in detections and warnings (unsafe URL etc).</li>
</ul>
<p>I will continue to work to reduce the number of false positives and keep improving obfuscated codes detection.</p>
<hr>
<p>Please think to drop a star on <a href="https://github.com/NodeSecure/js-x-ray">github</a> ‚ù§Ô∏è!</p>
<p>That's it for today! Thanks for reading me üòâ</p>

      </div>
    </article>
  </main>

  <script type="module" src="../src/particules.js"></script>
</body>

</html>