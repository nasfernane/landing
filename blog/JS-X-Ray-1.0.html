<!DOCTYPE html>
<html lang="en">
  
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link
    href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&display=swap"
    rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="../css/reset.css" />
  <link rel="stylesheet" href="../css/index.css" />
  <link rel="stylesheet" href="../css/blog.css" />
  <title>NodeSecure - Blog</title>
</head>

<body>
  <canvas id="network-bg"></canvas>

  <header class="blogHeader">
    <div class="header-background"></div>
    <div class="header-content centered-content">
      <img src="https://avatars.githubusercontent.com/u/85318671?s=200&v=4" alt="NodeSecure Logo"
        style="width:80px;height:80px;border-radius:20px;background:#fff2;box-shadow:0 2px 8px #0002;margin-bottom:1.2rem;">
      <h1>
        NodeSecure Blog
      </h1>
      <p class="subtitle">
        Building a safer Node.js and JavaScript ecosystem
      </p>
      <p class="description">We are a community of developers building free open source tools to secure the Node.js & JavaScript ecosystem. Our area of expertise is <b>SCA</b> (Software Composition Analysis).</p>
      <div class="header-buttons">
        <a href="https://github.com/NodeSecure" target="_blank" title="NodeSecure on GitHub" class="view-on-github">
          <img src="https://cdn.jsdelivr.net/gh/simple-icons/simple-icons/icons/github.svg" alt="GitHub"
            style="width:28px;height:28px;filter:invert(1) brightness(2);">
          <span>View on GitHub</span>
        </a>
        <a href="https://discord.gg/4Wn8rjAtB4" target="_blank" title="Join our Discord" class="view-on-discord">
          <img src="https://cdn.jsdelivr.net/gh/simple-icons/simple-icons/icons/discord.svg" alt="Discord"
            style="width:28px;height:28px;filter:invert(1) brightness(2);">
          <span>Join Discord</span>
        </a>
        <a href="./index.html" title="Visit our blog" class="view-on-discord">
          <img width="64" height="64" src="https://img.icons8.com/glyph-neue/64/circled-left-2.png"   style="width:28px;height:28px;filter:invert(1) brightness(2);" alt="Back to blog"/>
          <span>Back to blog</span>
        </a>
      </div>
    </div>
  </header>
  <main>
    
    <article>
      <div class="article-content">
        <h1 class="article-title">JS-X-Ray 1.0</h1>
        <p>Hi,</p>
<p>While I was working on the next release (0.6.0) of <a href="https://github.com/ES-Community/nsecure">Node-Secure</a> I thought that the AST analysis was getting bigger and bigger (and much more complicated too).</p>
<p>That's why I decided to separate all the analysis from the Node-secure project to allow easier maintenance and future enhancement. This also allows other projects to use my package if they need to!</p>
<p><a href="https://github.com/fraxken/js-x-ray">https://github.com/fraxken/js-x-ray</a></p>
<p>This is how <strong>JS-X-RAY</strong> was born. I have chosen the word x-ray because in games this is often a feature that allow to see through the walls, I like to imagine my analysis as being able to see through the most common techniques (obfuscation, etc.).</p>
<h1>The goal</h1>
<p>One of the primary goals of this package is to be able to find any required Node.js dependencies in a given code. If the analysis is not able to follow a require statement then an <strong>unsafe-import</strong> warning will be throw.</p>
<p>The more time goes and the more I think to make my code generic to also detect patterns specific to the front.</p>
<p>So I think the code will evolve in this direction :) </p>
<h1>Example</h1>
<hr>
<h2><strong>Purescript</strong></h2>
<p>Take the <a href="https://badjs.org/posts/purescript-installer/">purescript-installer incident</a> and specially the corrupted <a href="https://badjs.org/posts/purescript-installer/#heading-compromised-version-of-rate-map">rate-map code</a>.</p>
<blockquote>
<p>One of the objectives of node-secure is to be able to quickly identify code with warnings and give a bunch of very useful informations to the developer.</p>
</blockquote>
<p>In this case node-secure was able to detect the following dependencies:
<code>append-type</code>, <code>fs</code>, <code>dl-tar</code>.</p>
<pre><code class="language-js">const px = require.resolve(
Buffer.from([100, 108, 45, 116, 97, 114]).toString()
);
</code></pre>
<p>My AST analysis has detected a Buffer.from and as converted the value to <code>dl-tar</code> itself. In this case an <strong>unsafe-import</strong> will be throw with the file name and the Source Location.</p>
<hr>
<h2><strong>Event-stream</strong></h2>
<p>Take the <a href="https://badjs.org/posts/event-stream/">Payload A</a> in the event-stream incident.</p>
<p>So what's going on here?</p>
<ul>
<li><ol>
<li>assign of process and require into new variables.</li>
</ol>
</li>
<li><ol start="2">
<li>hexa value.</li>
</ol>
</li>
<li><ol start="3">
<li>code obfuscated (all identifiers have a length of 1).</li>
</ol>
</li>
</ul>
<p>I'm working on a bench of experimental analysis and warnings to be able to detect similar cases to event-stream incident.</p>
<pre><code class="language-json">[
  {
    "kind": "unsafe-assign",
    "start": { "line": 3, "column": 12 },
    "end": { "line": 3, "column": 23 },
    "value": "require"      
  },
  {
    "kind": "unsafe-assign",
    "start": { "line": 4, "column": 12 },
    "end": { "line": 4, "column": 23 },
    "value": "process"
  },
  {
    "kind": "hexa-value",
    "start": { "line": 9, "column": 20 },
    "end": { "line": 9, "column": 44 },
    "value": "./test/data"
  },
  {
    "kind": "short-ids",
    "start": { "line": 0, "column": 0 },
    "end": { "line": 0,"column": 0 },
    "value": 1
  }
]
</code></pre>
<p>However, A lot of packages may be detected as false positives (even if it's always better than nothing ðŸ˜…). It will surely take time to discover and improve these parameters.</p>
<h1>Conclusion</h1>
<p>Still a LOT of work has to be done to be able to achieve an accurate analysis. Right now the analysis is capable of gathering a whole of very useful information (unsafe-regex, unused and missing dependencies etc.).</p>
<p>I am always very excited to experience new warnings because they can detect patterns and errors that are often (un)common. Step by step they also lead me to a better understanding of the most dangerous patterns of the ecosystem.</p>
<blockquote>
<p>For example <strong>90%+ of the false positive</strong> are always generated because of files that was not mean to be published on the npm registry (tests, coverage files, etc.).</p>
</blockquote>
<p>Thanks for reading!</p>
<p>Best Regards,
Thomas</p>

      </div>
    </article>
  </main>

  <script type="module" src="../src/particules.js"></script>
</body>

</html>